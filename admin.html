<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Panel - BDS Center</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        input { padding: 10px; margin: 5px; width: 200px; }
        button { padding: 10px 20px; background: #1f7a4f; color: white; border: none; cursor: pointer; }
        .query { border: 1px solid #ccc; padding: 15px; margin: 10px 0; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Admin Login</h1>
    <input id="username" placeholder="Username" value="admin">
    <input id="password" type="password" placeholder="Password" value="bds123">
    <button onclick="login()">Login</button>
    
    <div id="adminPanel" style="display:none; margin-top:30px;">
        <h2>Patient Queries</h2>
        <div id="queryList">Loading...</div>
        <button onclick="clearAll()" style="background:#dc3545;">Clear All Queries</button>
    </div>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script>
        // DEBUG: Check loading
        console.log("Script loading...");
        
        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDwVp7Pn3WWezbBnWC0Ps7P3OppYrWQ5Jo",
            authDomain: "bdss-671d8.firebaseapp.com",
            projectId: "bdss-671d8"
        };
        
        // Initialize Firebase
        let db;
        try {
            const app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("✅ Firebase initialized successfully");
        } catch (error) {
            console.error("❌ Firebase init error:", error);
        }
        
        // Login function
        window.login = function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === "admin" && password === "bds123") {
                document.getElementById('adminPanel').style.display = 'block';
                loadQueries();
            } else {
                alert("Invalid credentials!");
            }
        };
        
        // Load queries from Firebase
        function loadQueries() {
            if (!db) {
                document.getElementById('queryList').innerHTML = "Firebase not initialized";
                return;
            }
            
            db.collection("patientQueries").orderBy("time", "desc")
                .get()
                .then((querySnapshot) => {
                    let html = '';
                    
                    if (querySnapshot.empty) {
                        html = '<p>No queries found.</p>';
                    } else {
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            html += `
                                <div class="query">
                                    <strong>${data.name || 'No name'}</strong><br>
                                    Phone: ${data.mobile || data.phone || 'No phone'}<br>
                                    Message: ${data.message || 'No message'}<br>
                                    Time: ${data.time ? new Date(data.time.toDate()).toLocaleString() : 'No time'}
                                </div>
                            `;
                        });
                    }
                    
                    document.getElementById('queryList').innerHTML = html;
                })
                .catch((error) => {
                    console.error("Error loading queries:", error);
                    document.getElementById('queryList').innerHTML = "Error loading queries: " + error.message;
                });
        }
        
        // Clear all queries
        window.clearAll = function() {
            if (confirm("Delete ALL queries? This cannot be undone!")) {
                db.collection("patientQueries").get().then(snapshot => {
                    const batch = db.batch();
                    snapshot.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    return batch.commit();
                }).then(() => {
                    alert("All queries deleted!");
                    loadQueries();
                }).catch(error => {
                    alert("Error: " + error.message);
                });
            }
        };
    </script>
</body>
</html>
