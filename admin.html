<!DOCTYPE html>
<html lang="en">
<head>
<title>Admin Panel - BDS Center</title>
<style>
* { box-sizing: border-box; font-family: "Segoe UI", sans-serif; }
body { margin: 0; background: #f5f5f5; }
.container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
.login-box, .admin-panel { 
    background: white; padding: 30px; border-radius: 15px; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px;
}
h1 { color: #1f7a4f; text-align: center; }
input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; }
button { background: #1f7a4f; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; width: 100%; }
button:hover { background: #166342; }
.query-item { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; background: #f9f9f9; }
.query-item strong { color: #1f7a4f; }
.header { background: linear-gradient(135deg, #1f7a4f, #2fb17c); color: white; padding: 20px; text-align: center; }
</style>
</head>

<body>
<div class="header">
    <h1>BDS CENTER - ADMIN PANEL</h1>
</div>

<div class="container">
    <div id="loginSection" class="login-box">
        <h2>Admin Login</h2>
        <input id="adminUser" placeholder="Username" value="admin">
        <input id="adminPass" type="password" placeholder="Password" value="bds123">
        <button onclick="login()">Login</button>
    </div>

    <div id="adminPanel" class="admin-panel" style="display:none;">
        <h2>üìã Patient Queries</h2>
        <div id="queryList">
            <p>Loading queries...</p>
        </div>
        <button onclick="logout()" style="background:#dc3545; margin-top:20px;">Logout</button>
    </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Configuration - MUST BE SAME AS INDEX.HTML
const firebaseConfig = {
    apiKey: "AIzaSyDwVp7Pn3WWezbBnWC0Ps7P3OppYrWQ5Jo",
    authDomain: "bdss-671d8.firebaseapp.com",
    projectId: "bdss-671d8"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

console.log("‚úÖ Admin Firebase initialized");

// Login function
window.login = function() {
    const username = document.getElementById('adminUser').value;
    const password = document.getElementById('adminPass').value;
    
    console.log("Login attempt:", username, password);
    
    if (username === "admin" && password === "bds123") {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadQueries();
    } else {
        alert("‚ùå Wrong username or password!");
    }
};

// Load queries from Firebase
function loadQueries() {
    console.log("Loading queries...");
    
    const queryList = document.getElementById('queryList');
    queryList.innerHTML = "<p>Loading queries...</p>";
    
    db.collection("patientQueries").orderBy("time", "desc")
        .get()
        .then((querySnapshot) => {
            console.log("Found", querySnapshot.size, "queries");
            
            if (querySnapshot.empty) {
                queryList.innerHTML = "<p>No queries found yet.</p>";
                return;
            }
            
            let html = '';
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const time = data.time ? new Date(data.time.toDate()).toLocaleString() : 'No time';
                
                html += `
                    <div class="query-item">
                        <strong>üë§ ${data.name || 'No name'}</strong><br>
                        üì± ${data.mobile || 'No phone'}<br>
                        üí¨ ${data.message || 'No message'}<br>
                        üìÖ ${time}
                    </div>
                `;
            });
            
            queryList.innerHTML = html;
        })
        .catch((error) => {
            console.error("Error loading queries:", error);
            queryList.innerHTML = `<p style="color:red;">Error loading queries: ${error.message}</p>`;
        });
}

// Logout function
window.logout = function() {
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('loginSection').style.display = 'block';
    document.getElementById('adminPass').value = '';
};

// Auto-login if already authenticated (optional)
// Uncomment if you want auto-login
// setTimeout(() => {
//     if (localStorage.getItem('adminLoggedIn') === 'true') {
//         login();
//     }
// }, 500);
</script>

</body>
</html>
